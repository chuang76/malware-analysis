import pefile
import binascii  
import hashlib 
import arc4 

def extract_data(pe):

    for section in pe.sections:
        if ".data" in section.Name.decode('utf-8'):
            encrypted_data = section.get_data(section.VirtualAddress, section.SizeOfRawData)
            return encrypted_data[16:]         # encrypted data 
    return None 

def rc4_decrypt(key, data):
    
    cipher = arc4.ARC4(key)
    decrypted_data = cipher.decrypt(data)
    return decrypted_data

def main():

    filename = "hancitor_dump.dll"
    pe = pefile.PE(filename)
    
    encrypted_data = extract_data(pe)
    key = encrypted_data[:8]
    encrypted_data = encrypted_data[8:8+0x2000]
    
    hashed_key = hashlib.sha1(key).digest()
    rc4_key = hashed_key[:5]
    
    decrpypted_data = rc4_decrypt(rc4_key, encrypted_data)
    print(decrpypted_data)

if __name__ == "__main__":
    main()